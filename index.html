<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>TravelPoint Pi</title>
<script src="https://sdk.minepi.com/pi-sdk.js"></script>
<style>
  body { font-family: system-ui, Arial; text-align:center; padding:40px; }
  button { padding:12px 18px; margin:10px; font-size:16px; border-radius:10px; }
  #log { white-space: pre-wrap; max-width:600px; margin:20px auto; text-align:left; border:1px solid #ccc; border-radius:10px; padding:10px; display:none; }
</style>
</head>
<body>
  <h2>TravelPoint Pi</h2>
  <p>Use <b>Pi Browser</b> to test a tiny payment flow.</p>
  <button id="btnLogin">üîë Login with Pi</button>
  <button id="btnPay">üí≥ Pay 0.001 Pi (test)</button>
  <div id="status">Booting‚Ä¶</div>
  <div id="log"></div>

<script>
(async function(){
  const status = document.getElementById('status');
  const logBox = document.getElementById('log');
  const log = msg => { logBox.style.display='block'; logBox.textContent += msg + "\n"; console.log(msg); };

  // –ü—Ä–æ–≤–µ—Ä–∫–∞ SDK
  if (!window.Pi) {
    status.textContent = "‚ùå Pi SDK not found. Open this page inside Pi Browser.";
    return;
  }

  try {
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    Pi.init({ version: "2.0", sandbox: true });
    status.textContent = "‚úÖ Pi SDK initialized.";
  } catch(e) {
    status.textContent = "‚ùå Pi.init() error: " + e.message;
    return;
  }

  const btnLogin = document.getElementById('btnLogin');
  const btnPay = document.getElementById('btnPay');

  btnLogin.onclick = async () => {
    try {
      const scopes = ['username','payments'];
      const auth = await Pi.authenticate(scopes, onIncompletePaymentFound);
      log("‚úÖ Logged in as: " + auth.user.username);
      status.textContent = "Logged in: " + auth.user.username;
    } catch (err) {
      log("‚ùå Login error: " + err.message);
      status.textContent = "Login failed.";
    }
  };

  btnPay.onclick = async () => {
    try {
      const payment = await Pi.createPayment({
        amount: 0.001,
        memo: "TravelPoint Test Payment",
        metadata: { type: "test" }
      }, {
        onReadyForServerApproval: paymentId => log("onReadyForServerApproval: " + paymentId),
        onReadyForServerCompletion: paymentId => log("onReadyForServerCompletion: " + paymentId),
        onCancel: paymentId => log("onCancel: " + paymentId),
        onError: (error, payment) => log("onError: " + error)
      });
      log("‚úÖ Payment created: " + JSON.stringify(payment));
      status.textContent = "Payment flow complete.";
    } catch (err) {
      log("‚ùå Payment error: " + err.message);
      status.textContent = "Payment failed.";
    }
  };

  function onIncompletePaymentFound(payment){
    log("‚ö†Ô∏è Incomplete payment: " + JSON.stringify(payment));
  }
})();
</script>
</body>
</html>
