<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>TravelPoint Pi ¬∑ Sandbox</title>
  <script src="https://sdk.minepi.com/pi-sdk.js"></script>
  <style>
    body { font-family: system-ui, Arial, sans-serif; max-width: 720px; margin: 40px auto; line-height: 1.5; padding: 0 16px; }
    h1 { margin: 0 0 8px; }
    #status { padding: 10px; background: #f6f7fb; border: 1px solid #e3e5ef; border-radius: 10px; margin: 16px 0; }
    button { padding: 10px 14px; margin: 6px 8px 6px 0; border-radius: 8px; border: 1px solid #d0d4e1; cursor: pointer; }
    button:disabled { opacity: .5; cursor: not-allowed; }
    code { background:#f1f3f8; padding:2px 6px; border-radius:6px; }
  </style>
</head>
<body>
  <h1>üöÄ TravelPoint Pi (Sandbox)</h1>
  <p>Demo –¥–ª—è Pi Hackathon: –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∏ —Ç–µ—Å—Ç–æ–≤—ã–π –ø–ª–∞—Ç—ë–∂ —á–µ—Ä–µ–∑ Pi SDK.</p>

  <div id="status">–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è‚Ä¶</div>

  <button id="loginBtn" disabled>üîë Login with Pi</button>
  <button id="payBtn" disabled>üí≥ Pay 1 Pi (Test)</button>

  <p style="font-size:14px;color:#555">
    –ï—Å–ª–∏ –∫–Ω–æ–ø–∫–∏ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã: –æ—Ç–∫—Ä–æ–π—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤ <strong>Pi Browser</strong> –∏ —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤
    <em>Develop ‚Üí Configure App‚Äôs Development URL</em> –¥–æ–±–∞–≤–ª–µ–Ω –≤–∞—à URL.
  </p>

  <script>
    // --- 1) –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø SDK –í –ü–ï–°–û–ß–ù–ò–¶–ï ---
    try {
      // sandbox: true ‚Äî –û–ë–Ø–ó–ê–¢–ï–õ–ï–ù –¥–ª—è —à–∞–≥–∞ "Run Development App in the Sandbox"
      Pi.init({ version: "2.0", sandbox: true });
    } catch (_) {}

    const statusEl = document.getElementById('status');
    const loginBtn = document.getElementById('loginBtn');
    const payBtn   = document.getElementById('payBtn');
    let user = null;

    const isPiEnv = () =>
      typeof Pi !== 'undefined' && Pi && typeof Pi.authenticate === 'function';

    function setStatus(msg){ statusEl.textContent = msg; }

    if (!isPiEnv()) {
      setStatus("‚ö†Ô∏è –û—Ç–∫—Ä–æ–π—Ç–µ —ç—Ç—É —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤ Pi Browser. –¢–∞–∫–∂–µ —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤–∞—à Vercel-URL –¥–æ–±–∞–≤–ª–µ–Ω –≤ Develop ‚Üí Configure App‚Äôs Development URL.");
    } else {
      setStatus("‚úÖ Pi SDK –æ–±–Ω–∞—Ä—É–∂–µ–Ω. –ù–∞–∂–º–∏—Ç–µ ‚ÄúLogin with Pi‚Äù.");
      loginBtn.disabled = false;
    }

    // --- 2) –û–ë–†–ê–ë–û–¢–ß–ò–ö –ù–ï–ó–ê–í–ï–†–®–Å–ù–ù–´–• –ü–õ–ê–¢–ï–ñ–ï–ô ---
    function onIncompletePaymentFound(payment){
      console.log("Incomplete payment:", payment);
    }

    // --- 3) –õ–û–ì–ò–ù ---
    loginBtn.addEventListener('click', async () => {
      if (!isPiEnv()) {
        alert("–û—Ç–∫—Ä–æ–π—Ç–µ –≤ Pi Browser –∏ –¥–æ–±–∞–≤—å—Ç–µ URL –≤ Pi Develop.");
        return;
      }
      try {
        user = await Pi.authenticate(["username","payments"], onIncompletePaymentFound);
        setStatus("‚úÖ –í–æ—à–ª–∏ –∫–∞–∫ @" + user.username);
        payBtn.disabled = false;
      } catch (e) {
        console.error(e);
        setStatus("‚ùå Login failed. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Pi Browser, sandbox –∏ allowlist URL.");
      }
    });

    // --- 4) –¢–ï–°–¢–û–í–´–ô –ü–õ–ê–¢–Å–ñ ---
    payBtn.addEventListener('click', async () => {
      if (!user) return alert("–°–Ω–∞—á–∞–ª–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –≤—Ö–æ–¥.");
      try {
        const payment = await Pi.createPayment(
          { amount: 1, memo: "Test payment for TravelPoint", metadata: {type:"test"} },
          {
            onReadyForServerApproval: (pid)=>console.log("onReadyForServerApproval", pid),
            onReadyForServerCompletion: (pid, txid)=>console.log("onReadyForServerCompletion", pid, txid),
            onCancel: (pid)=>console.log("onCancel", pid),
            onError: (err, pid)=>console.log("onError", err, pid)
          }
        );
        console.log("Payment created:", payment);
        setStatus("‚úÖ –ü–ª–∞—Ç—ë–∂ –∏–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞–Ω. –°–º–æ—Ç—Ä–∏—Ç–µ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ Pi Wallet.");
      } catch (e) {
        console.error(e);
        setStatus("‚ùå Payment failed. –°–º–æ—Ç—Ä–∏—Ç–µ –∫–æ–Ω—Å–æ–ª—å Pi Browser.");
      }
    });
  </script>
</body>
</html>
