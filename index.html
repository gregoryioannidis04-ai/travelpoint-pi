<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TravelPoint Pi</title>
  <script src="https://sdk.minepi.com/pi-sdk.js"></script>
</head>
<body>
  <h1>ğŸš€ Welcome to TravelPoint Pi</h1>
  <p>This is the first test deployment of our Pi Hackathon project.</p>

  <button id="loginBtn">ğŸ”‘ Login with Pi</button>
  <button id="payBtn" disabled>ğŸ’³ Pay 1 Pi (Test)</button>

  <script>
    // 1. Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ SDK
    Pi.init({ version: "2.0" });
    console.log("Pi SDK initialized");

    let user = null;

    // 2. ĞĞ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
    document.getElementById("loginBtn").addEventListener("click", async () => {
      try {
        user = await Pi.authenticate(["username", "payments"], onIncompletePaymentFound);
        console.log("Authenticated user:", user);
        alert("âœ… Logged in as " + user.username);
        document.getElementById("payBtn").disabled = false;
      } catch (err) {
        console.error(err);
        alert("âŒ Login failed");
      }
    });

    // 3. ĞŸĞ»Ğ°Ñ‚Ñ‘Ğ¶
    document.getElementById("payBtn").addEventListener("click", async () => {
      try {
        const paymentData = {
          amount: 1, // Ğ¡ĞºĞ¾Ğ»ÑŒĞºĞ¾ Pi
          memo: "Test payment for TravelPoint", // ĞšĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸Ğ¹
          metadata: { type: "test" } // Ğ›ÑĞ±Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ
        };

        const payment = await Pi.createPayment(paymentData, {
          onReadyForServerApproval: (paymentId) => {
            console.log("Ready for server approval:", paymentId);
          },
          onReadyForServerCompletion: (paymentId, txid) => {
            console.log("Ready for server completion:", paymentId, txid);
          },
          onCancel: (paymentId) => {
            console.log("Payment cancelled:", paymentId);
          },
          onError: (error, paymentId) => {
            console.error("Payment error:", error, paymentId);
          }
        });

        console.log("Payment created:", payment);
        alert("âœ… Payment successful (check console)");

      } catch (err) {
        console.error(err);
        alert("âŒ Payment failed");
      }
    });

    // 4. ĞĞµĞ¿Ğ¾Ğ»Ğ½Ñ‹Ğµ Ğ¿Ğ»Ğ°Ñ‚ĞµĞ¶Ğ¸
    function onIncompletePaymentFound(payment) {
      console.log("Incomplete payment found:", payment);
    }
  </script>
</body>
</html>
