<script src="https://sdk.minepi.com/pi-sdk.js"></script>
<script>
  const out = (msg, obj) => {
    const box = document.getElementById('out');
    const text = typeof msg === 'string' ? msg : JSON.stringify(msg, null, 2);
    box.textContent += text + (obj ? ' ' + JSON.stringify(obj, null, 2) : '') + '\n';
  };

  document.addEventListener('DOMContentLoaded', async () => {
    // кнопки
    const btnClick  = document.getElementById('btnClick');
    const btnCheck  = document.getElementById('btnCheck');
    const btnLogin  = document.getElementById('btnLogin');

    btnClick.addEventListener('click', () => {
      alert('Click works ✅');
      out('click: OK');
    });

    btnCheck.addEventListener('click', () => {
      out('window.Pi = ' + (!!window.Pi));
      if (window.Pi) {
        out('Pi.init sandbox:true ✅');
      } else {
        out('❌ Pi SDK not found. Open page IN Pi Browser.');
      }
    });

    // ИНИЦИАЛИЗАЦИЯ SDK (TESTNET!)
    if (!window.Pi) {
      out('❌ Pi SDK not found'); 
      return;
    }
    try {
      Pi.init({ version: '2.0', sandbox: true }); // Testnet = true
      out('Pi.init done (sandbox:true)');
    } catch(e) {
      out('Pi.init error', { message: e?.message, code: e?.code });
    }

    // ВЫЗОВ АВТОРИЗАЦИИ С ПОЛНЫМ ЛОГОМ ОШИБОК
    btnLogin.addEventListener('click', async () => {
      out('login button pressed');
      try {
        const scopes = ['username', 'payments'];
        const auth = await Pi.authenticate(scopes, (p) => out('onIncompletePaymentFound', p));
        out('AUTH OK ✅', auth);
        alert('Authenticated as @' + auth?.user?.username);
      } catch (e) {
        // покажем ВСЁ, что пришло
        out('AUTH ERROR ❌', {
          name: e?.name,
          message: e?.message,
          code: e?.code,
          toString: e?.toString?.()
        });
        alert('Auth error: ' + (e?.code  e?.message  'unknown'));
      }
    });
  });
</script>
